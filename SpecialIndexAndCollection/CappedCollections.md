## 固定集合

Mongodb 中的 "普通" 集合是动态创建的, 而且可以自动增长以容纳更多数据.  
Mongodb 还有另一种类的集合,叫做 __固定集合__, 固定集合需要事先创建好,而且它的大小是固定的.  

- 当固定集合被占满时, 如果再插入新的文档,固定集合会将最老的文档删除.  
- 固定集合的访问模式与 大部分集合不同
    - 数据被顺序写入磁盘上的固定空间, 因此写入速度非常快.
    - 固定集合不能被分片
    - 固定集合可以用于 记录日志,尽管不够灵活.
    - 虽然创建时指定集合大小,但是无法控制什么时候数据会被覆盖

### 创建固定集合

__固定集合必须在使用之前显式创建__ .  
使用 `create` 命令创建固定集合. 在 shell 中,可以使用 `createCollection` 函数
还可以指定固定集合文档的数量  
创建之后不能改变,如果需要修改只能删除重建.  
可以通过 `convertToCapped` 实现 将某个常规集合转换为固定集合, 但是无法将固定集合转换为 普通集合.

案例:  
```bash
# 创建一个名为 my_collection 大小为 100000 字节的固定集合
> db.createCollection("my_collection", {"capped":true, "size": 100000})
{"ok" : 1 }
# 指定只能有 100 个文档
> db.createCollection("capped_col", {"capped":true, "size":100000, "max":100});
# 将 test 集合转换为 大小为 100000 字节集合的固定集合
> db.runCommand({"convertToCapped": "test", "size": 100000})
```

### 自然排序

对固定集合尅进行一种特殊的排序, 称为 自然排序(natural sort).  
自然排序返回的结果文档的顺序就是文档在磁盘上的顺序.  

对于大多数集合,自然排序的意义不大,因为文档的位置经常变动.  

### 循环游标(tailable cursor)

一种特殊游标, 当循环游标结果集被取光后,游标不会关闭.  
循环游标的灵感来自 `tail -f` 命令.  
当新的文档插入到集合中,循环游标会继续渠道结果.  

循环游标通常用于当文档被插入到 "工作队列" 是对新插入文档进行处理.  

### 没有 `_id` 索引的集合

默认情况下, 每个集合都有 `_id` 索引. 但是如果在调用 `createCollection` 创建 autoIndexId 选项为 false,但是建议不要这么使用.  
