## 索引类型

创建索引是可以指定一些选项,使用不同选项建立的索引会有不同的行为.  

- 唯一索引
- 稀疏索引

### 唯一索引

唯一索引可以确保集合的每个文档的指定键都有唯一值.  

> __注意__ 如果一个文档没有对应的键,索引会将其作为 null 存储. 所以对某个键建立唯一索引,
但插入了多个缺少该键的文档,由于集合已存在 null 的文档而导致失败.  

案例:  
```js
> db.users.ensureIndex({"username":1},{"unique":true});
```

发现有重复的键时抛出异常会影响效率.  

有些情况下,一个值可能无法被索引. 索引储桶(index bucket)的大小是有限制的,
如果某个索引条目超出了限制,那么这个条目就不会包含在索引里.  

所以所有的字段都必须小于 1024 字节 ,才能包含到索引里.  

如果一个文档的字段太大不能包含在索引里, mongodb 不会反悔任何错误或者警告. 也就是说,超出8KB 大小的键不受唯一索引的约束.  

> 1. 复合唯一索引

也可以创建唯一复合索引. 创建复合索引是,单个键的值可以相同,但是所有键的组合必须是唯一.  

> 2. 去除重复

在已有的集合上创建唯一索引可能会失败,因为集合可能已经存在重复值了.  
通常需要对已有的数据进行处理.  
少数情况下,希望直接删除重复值.  

```js
// dropDups 会强制性建立唯一索引, 但是太粗暴了
> db.people.ensureIndex({"username":1},{'unique':true,"dropDups":true})
```

### 稀疏索引

唯一索引会把 null 看做值, 所以无法将多个缺少唯一索引中的键的文档插入到集合中.  
然而,在有些情况下, 你可能希望唯一索引 __只对包含相应的文档生效__ .  

> MongoDB 中的稀疏索引,与关系型数据库中的稀疏索引是完全不同的概念.
基本上, mongodb 中的稀疏索引只是不需要讲每个文档都作为索引条目  

使用 `sparse` 选项创建稀疏索引.  

例如:  

```js
// 要么不设置,如果提供这个字段,那么这个值必须是唯一的.
> db.users.ensureIndex({"email":1},{"unique":true,"sparse":true});
```

稀疏索引不必是唯一的, 只要去掉 `unique` ,就可以创建一个非唯一的稀疏索引.  

差异 demo:  

```js
// 3.0 差异
...
```
